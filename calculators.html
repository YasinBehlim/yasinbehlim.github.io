<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crypto Calculators</title>
<meta name="description" content="Live Crypto Price Checker, Profit/Loss Calculator, USD Converter. Works on GitHub Pages with CORS fix.">

<style>
:root{--bg:#0d1117;--panel:#161b22;--text:#fff;--muted:#8b949e;--accent:#238636;}
body{margin:0;padding:20px;background:var(--bg);color:var(--text);font-family:system-ui;}
.container{max-width:960px;margin:auto;}
h1,h2{margin:0 0 10px;}
.box{background:var(--panel);padding:20px;margin:15px 0;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.3);}
input,select{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:none;background:#0001;color:var(--text);}
button{padding:12px 20px;background:var(--accent);color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
@media(max-width:640px){.row{grid-template-columns:1fr;}}
.result{margin-top:10px;font-size:1.3rem;}
</style>
</head>
<body>
<div class="container">
<h1>Crypto Calculators</h1>

<!-- Live Price Checker -->
<div class="box">
<h2>Live Price Checker</h2>
<input type="text" id="searchCoin" placeholder="Search coin (e.g., bitcoin)">
<select id="coinList"></select>
<button onclick="checkPrice()">Check Price</button>
<p id="priceDisplay" class="result"></p>
</div>

<!-- Profit/Loss Calculator -->
<div class="box">
<h2>Profit / Loss Calculator</h2>
<div class="row">
<input type="number" step="any" id="buyPrice" placeholder="Buy Price (USD)">
<input type="number" step="any" id="sellPrice" placeholder="Sell Price (USD)">
</div>
<input type="number" step="any" id="coinAmount" placeholder="Amount of coins" style="margin-top:12px;">
<button onclick="calculateProfit()">Calculate</button>
<p id="profitDisplay" class="result"></p>
</div>

<!-- USD Converter -->
<div class="box">
<h2>Crypto â†’ USD Converter</h2>
<div class="row">
<input type="number" step="any" id="convertPrice" placeholder="Coin Price (USD)">
<input type="number" step="any" id="convertAmount" placeholder="Amount of coins">
</div>
<button onclick="convertUSD()">Convert</button>
<p id="convertDisplay" class="result"></p>
</div>
</div>

<script>
let allCoins = [];

// Use CORS proxy to fetch coins list
fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&per_page=250'))
  .then(r => r.json())
  .then(data => {
    allCoins = JSON.parse(data.contents);
    populateCoinList(allCoins);
  })
  .catch(e => console.error("Error fetching coins:", e));

// Populate dropdown
function populateCoinList(coins){
  const select = document.getElementById('coinList');
  select.innerHTML = '';
  coins.forEach(c => {
    let option = document.createElement('option');
    option.value = c.id;
    option.textContent = `${c.name} (${c.symbol.toUpperCase()})`;
    select.appendChild(option);
  });
}

// Filter coins on search
document.getElementById('searchCoin').oninput = e => {
  let query = e.target.value.toLowerCase();
  populateCoinList(allCoins.filter(c => c.name.toLowerCase().includes(query) || c.symbol.includes(query)));
}

// Check live price
function checkPrice(){
  let coinId = document.getElementById('coinList').value;
  if(!coinId) return;
  fetch('https://api.allorigins.win/get?url=' + encodeURIComponent(`https://api.coingecko.com/api/v3/simple/price?ids=${coinId}&vs_currencies=usd`))
    .then(r => r.json())
    .then(data => {
      let content = JSON.parse(data.contents);
      document.getElementById('priceDisplay').textContent = `$${content[coinId].usd.toLocaleString()}`;
    })
    .catch(e => document.getElementById('priceDisplay').textContent = 'Error fetching price');
}

// Profit/Loss Calculator
function calculateProfit(){
  let buy = +document.getElementById('buyPrice').value;
  let sell = +document.getElementById('sellPrice').value;
  let amt = +document.getElementById('coinAmount').value;
  if(isNaN(buy)||isNaN(sell)||isNaN(amt)){alert("Enter valid numbers"); return;}
  let profit = (sell - buy) * amt;
  document.getElementById('profitDisplay').innerHTML = `Profit: <strong style="color:${profit>=0?'#238636':'#e5534b'}">$${profit.toFixed(2)}</strong>`;
}

// USD Converter
function convertUSD(){
  let price = +document.getElementById('convertPrice').value;
  let amt = +document.getElementById('convertAmount').value;
  if(isNaN(price)||isNaN(amt)){alert("Enter valid numbers"); return;}
  document.getElementById('convertDisplay').innerHTML = `Total: <strong style="color:#238636">$${(price*amt).toFixed(2)}</strong>`;
}
</script>
</body>
</html>
